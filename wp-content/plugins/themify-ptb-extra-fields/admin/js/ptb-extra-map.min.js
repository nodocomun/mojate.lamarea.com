var ptb_extra_geocoder;
function ptb_extra_map_init(l){function q(c,a,d){ptb_extra_geocoder||(ptb_extra_geocoder=new google.maps.Geocoder);var b={};b[a]=c;ptb_extra_geocoder.geocode(b,function(b,a){"OK"!==a&&(b[0]=null);d(b[0])})}function g(g,a,d,b,m,e,f,h,n,k){b?(b.geometry.viewport?g.fitBounds(b.geometry.viewport):(g.setCenter(b.geometry.location),g.setZoom(17)),b.icon?a.setIcon({url:b.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}):
a.setIcon(),a.setPosition(k?k:b.geometry.location),a.setVisible(!0),n||(c.trim(d.val())?e=c.trim(d.val()).replace(/(?:\r\n|\r|\n)/ig,"<br />"):(b.address_components&&(e=[b.address_components[0]&&b.address_components[0].short_name||"",b.address_components[1]&&b.address_components[1].short_name||"",b.address_components[2]&&b.address_components[2].short_name||""].join(" ")),d.val(e),e="<div><strong>"+b.name+"</strong><br>"+e)),f.setContent(e),f.open(g,a),k||h.val(b.geometry.location.lat()+", "+b.geometry.location.lng()),
m.val(JSON.stringify({place:b.place_id,location:k?k:b.geometry.location}))):(m.val(""),h.val(""),a.setVisible(!1))}var c=jQuery;c(".ptb_post_cmb_item_map").each(function(){var r={center:new google.maps.LatLng(43.67023,-79.38676),zoom:13},a=c(this).prop("id"),d=new google.maps.Map(document.getElementById("ptb_extra_"+a+"_canvas"),r),b=document.getElementById("ptb_extra_"+a+"_location"),r=document.getElementById("ptb_extra_"+a+"_select");d.controls[google.maps.ControlPosition.TOP_LEFT].push(b);d.controls[google.maps.ControlPosition.TOP_LEFT].push(r);
var m=new google.maps.places.Autocomplete(b);m.bindTo("bounds",d);var e=new google.maps.InfoWindow,f=new google.maps.Marker({map:d,anchorPoint:new google.maps.Point(0,-29),draggable:!0,animation:google.maps.Animation.DROP}),h=!1,n=c("#ptb_extra_"+a+"_place"),k=c("#ptb_extra_"+a+"_info"),p=c("#ptb_extra_"+a+"_lat");if(a=n.val())if(a=c.parseJSON(a))a.location?(f.setPosition({lat:a.location.lat,lng:a.location.lng}),d.setCenter({lat:a.location.lat,lng:a.location.lng}),c.trim(k.val())&&(e.setContent(c.trim(k.val())),
e.open(d,f)),p.val(a.location.lat+", "+a.location.lng)):a.place&&(new google.maps.places.PlacesService(d)).getDetails({placeId:a.place},function(a,d){d===google.maps.places.PlacesServiceStatus.OK&&(h=a,google.maps.event.trigger(m,"place_changed",l),a.formatted_address?c(b).val(a.formatted_address):c(b).val(a.name))});google.maps.event.addListener(f,"dragend",function(){p.val(f.getPosition().lat()+", "+f.getPosition().lng())});google.maps.event.addListener(m,"place_changed",function(a){e.close();f.setVisible(!1);
var t="";if(h)a=h,t=c.trim(k.val()),h=!1;else{var l=c.trim(c(b).val());if(""!==l){if(a=a?!1:m.getPlace(),!a||!a.geometry){q(l,"address",function(a){a&&a.geometry?g(d,f,k,a,n,t,e,p,h):alert("Autocomplete's returned place contains no geometry")});return}}else{g(d,f,k,"",n,t,e,p,h);return}}g(d,f,k,a,n,t,e,p,h)});google.maps.event.addListener(f,"click",function(){e.open(d,f)});google.maps.event.addDomListener(b,"keydown",function(a){13===a.keyCode&&event.preventDefault()});p.on("change",function(){var a=
c.trim(c(this).val());""!==a?(a=a.split(","),a[1]&&(a={lat:parseFloat(c.trim(a[0])),lng:parseFloat(c.trim(a[1]))},q(a,"location",function(h){h&&h.geometry?(c(b).val(h.formatted_address),g(d,f,k,h,n,"",e,p,!1,a)):alert("Autocomplete's returned place contains no geometry")}))):g(d,f,k,"",n,"",e,p,!1)});c(r).change(function(){m.setTypes([c(this).val()])});k.keyup(function(){var a=c.trim(c(this).val()).replace(/(?:\r\n|\r|\n)/ig,"<br />");e.setContent(a)})})}
(function(l){l(document).on("ptb_add_metabox_map",function(l){return{}}).ready(function(){if(0<l(".ptb_post_cmb_item_map").length)if("object"!==typeof google||"object"!==typeof google.maps||"undefined"===typeof google.maps.places){"object"===typeof google&&null!==google&&"object"===typeof google.maps&&"undefined"===typeof google.maps.places&&(google.maps=null);var q="//maps.googleapis.com/maps/api/js?v=3&libraries=places&callback=ptb_extra_map_init&language="+ptb_extra.lng+"&key="+ptb_extra.map_key,
g=document.createElement("script");g.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(g);g.async=!0;g.src=q}else ptb_extra_map_init()})})(jQuery);
