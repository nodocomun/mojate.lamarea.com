var PTB_Submission_Map=function(){function g(e,a,c,d){q.geocode({latLng:{lat:"function"===typeof e.lat?e.lat():e.lat,lng:"function"===typeof e.lng?e.lng():e.lng}},function(e){e&&0<e.length?(a.setContent(e[0].formatted_address),a.open(c,d)):(a.close(),a.setContent(""))})}function n(e,a,c){e.val(JSON.stringify({place:a,location:[c.lat(),c.lng()]}))}function d(e){q||(q=new google.maps.Geocoder);var a={center:new google.maps.LatLng(43.67023,-79.38676),zoom:13,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}},
c=new google.maps.Map(document.getElementById("ptb_extra_"+e+"_canvas"),a),d=document.getElementById("ptb_extra_"+e+"_location"),m=new google.maps.places.Autocomplete(d);m.bindTo("bounds",c);var h=new google.maps.InfoWindow({maxWidth:300}),f=new google.maps.Marker({map:c,draggable:!0,position:a.center,animation:google.maps.Animation.DROP,anchorPoint:new google.maps.Point(0,-29)});f.setVisible(!0);var l=!1,p=k("#ptb_extra_"+e+"_place");if(a=p.val())if(a=k.parseJSON(a))a.location?(a={lat:a.location.lat?
a.location.lat:a.location[0],lng:a.location.lng?a.location.lng:a.location[1]},f.setPosition(a),c.setCenter(a),g(a,h,c,f),delete a):a.place&&(new google.maps.places.PlacesService(c)).getDetails({placeId:a.place},function(a,b){b==google.maps.places.PlacesServiceStatus.OK&&(l=a,google.maps.event.trigger(m,"place_changed",e),a.formatted_address?k(d).val(a.formatted_address):k(d).val(a.name))});google.maps.event.addListener(c,"click",function(a){f.setPosition(a.latLng);g(a.latLng,h,c,f);n(p,"",a.latLng)});
google.maps.event.addListener(f,"dragstart",function(){h.close()});google.maps.event.addListener(f,"dragend",function(){var a=f.getPosition();g(a,h,c,f);n(p,"",a)});google.maps.event.addListener(f,"click",function(){h.open(c,f)});google.maps.event.addListener(m,"place_changed",function(){h.close();var a="";if(l){var b=l;l=!1}else if(b=m.getPlace(),!b||!b.geometry){alert("Autocomplete's returned place contains no geometry");return}b.geometry.viewport?c.fitBounds(b.geometry.viewport):(c.setCenter(b.geometry.location),
c.setZoom(17));f.setIcon({url:b.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)});f.setPosition(b.geometry.location);f.setVisible(!0);!l&&b.address_components&&(a=[b.address_components[0]&&b.address_components[0].short_name||"",b.address_components[1]&&b.address_components[1].short_name||"",b.address_components[2]&&b.address_components[2].short_name||""].join(" "),a="<div><strong>"+b.name+"</strong><br>"+
a);h.setContent(a);h.open(c,f);n(p,b.place_id,b.geometry.location)})}var k=jQuery,q;k(".ptb_extras_submission_map").each(function(){d(k(this).data("id"))})};
(function(g){g(document).ready(function(){if("object"!==typeof google||"object"!==typeof google.maps||"undefined"===typeof google.maps.places){"object"===typeof google&&null!==google&&"object"===typeof google.maps&&"undefined"===typeof google.maps.places&&(google.maps=null);var g="//maps.googleapis.com/maps/api/js?v=3.exp&signed_in=false&sensor=false&libraries=places&callback=PTB_Submission_Map&language="+ptb_submission.lng+"&key="+ptb_extra.map_key,d=document.createElement("script");d.type="text/javascript";
d.async="async";d.defer="defer";document.getElementsByTagName("head")[0].appendChild(d);d.src=g}else PTB_Submission_Map()});g(document).on("ptb_submission_validate",function(n,d){d=g(this);if(0<d.closest(".ptb_extra_submission_map_control").length)return d.is(":hidden")&&!g.trim(d.val())})})(jQuery);
